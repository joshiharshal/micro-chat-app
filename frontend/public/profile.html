<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ApexChat - User Profile</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
<style>
:root {
  --primary-color: #6366f1;
  --secondary-color: #8b5cf6;
  --bg-color: #f8fafc;
  --card-bg: #ffffff;
  --text-primary: #1e293b;
  --text-secondary: #64748b;
  --border-color: #e2e8f0;
  --shadow: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06);
}
[data-theme="dark"] {
  --bg-color:#0f0f23;
  --card-bg:#1a1a2e;
  --text-primary:#f8fafc;
  --text-secondary:#94a3b8;
  --border-color:#334155;
}
body { background: var(--bg-color); color: var(--text-primary); font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin:0; min-height:100vh; display:flex; flex-direction:column; }
.navbar { background: var(--primary-color); padding:1rem 0; box-shadow: var(--shadow); position: sticky; top:0; z-index:1000; }
.navbar-brand { font-size:1.5rem; font-weight:bold; color:white !important; }
.nav-link { color: rgba(255,255,255,0.9) !important; margin:0 0.5rem; transition: color 0.2s; }
.nav-link:hover, .nav-link.active { color: white !important; }
.user-nav { display:flex; align-items:center; gap:1rem; }
.user-avatar-nav { width:35px; height:35px; border-radius:50%; background:rgba(255,255,255,0.2); display:flex; align-items:center; justify-content:center; color:white; font-weight:bold; }
.main-container { flex:1; max-width:800px; margin:2rem auto; padding:0 1rem; overflow-y:auto; }
.login-prompt { display:flex; flex-direction:column; align-items:center; justify-content:center; height:100%; text-align:center; color: var(--text-secondary); }
.login-prompt i { font-size:4rem; color: var(--primary-color); margin-bottom:1rem; }
.btn-login-prompt { background: var(--primary-color); color:white; border:none; padding:0.75rem 2rem; border-radius:0.5rem; text-decoration:none; margin:0.5rem; display:inline-block; transition: background 0.2s; }
.btn-login-prompt:hover { background: var(--secondary-color); color:white; }
.profile-card { background: var(--card-bg); border:1px solid var(--border-color); border-radius:0.75rem; padding:2rem; box-shadow: var(--shadow); display:none; animation:fadeIn 0.5s ease-in; }
@keyframes fadeIn { from { opacity:0; transform:translateY(20px); } to { opacity:1; transform:translateY(0); } }
.profile-header { display:flex; align-items:center; justify-content:space-between; margin-bottom:2rem; flex-wrap:wrap; gap:1rem; }
.profile-avatar-section { display:flex; align-items:center; gap:1rem; }
.profile-avatar { width:80px; height:80px; border-radius:50%; background:var(--primary-color); color:white; display:flex; align-items:center; justify-content:center; font-size:2rem; font-weight:bold; border:3px solid var(--border-color); }
.profile-info h1 { margin:0; font-size:1.75rem; }
.profile-info p { margin:0; color: var(--text-secondary); }
.btn-edit { background: var(--primary-color); color:white; border:none; padding:0.5rem 1rem; border-radius:0.5rem; cursor:pointer; transition: background 0.2s; }
.btn-edit:hover { background: var(--secondary-color); }
.profile-section { margin-bottom:2rem; padding-bottom:1.5rem; border-bottom:1px solid var(--border-color); }
.profile-section:last-child { border-bottom:none; margin-bottom:0; }
.profile-section h3 { color: var(--primary-color); margin-bottom:1rem; display:flex; align-items:center; gap:0.5rem; }
.info-item { display:flex; justify-content:space-between; margin-bottom:0.5rem; padding:0.5rem; background: var(--bg-color); border-radius:0.5rem; }
.footer { background: var(--card-bg); border-top:1px solid var(--border-color); padding:1rem 0; text-align:center; color: var(--text-secondary); margin-top:auto; }
.footer a { color: var(--primary-color); text-decoration:none; }
.theme-toggle { background:none; border:none; color:white; font-size:1.2rem; cursor:pointer; }
</style>
</head>
<body data-theme="light">

<nav class="navbar navbar-expand-lg">
  <div class="container">
    <a class="navbar-brand" href="index.html"><i class="fas fa-comments"></i> ApexChat</a>
    <ul class="navbar-nav me-auto">
      <li class="nav-item"><a class="nav-link" href="index.html">Home</a></li>
      <li class="nav-item"><a class="nav-link" href="chat.html">Private Chat</a></li>
      <li class="nav-item"><a class="nav-link" href="groups.html">Groups</a></li>
      <li class="nav-item"><a class="nav-link active" href="profile.html">Profile</a></li>
      <li class="nav-item"><a class="nav-link" href="analytics.html">Analytics</a></li>
    </ul>
    <ul class="navbar-nav user-nav">
      <li class="nav-item"><a class="nav-link" href="#notifications"><i class="fas fa-bell"></i></a></li>
      <li class="nav-item dropdown">
        <a class="nav-link" href="#" role="button" data-bs-toggle="dropdown">
          <div class="user-avatar-nav" id="userAvatarNav">A</div> <span id="userNameNav">Guest</span>
        </a>
        <ul class="dropdown-menu">
          <li><a class="dropdown-item" href="profile.html">View Profile</a></li>
          <li><a class="dropdown-item" href="#" onclick="logout()">Logout</a></li>
        </ul>
      </li>
      <li class="nav-item"><button class="theme-toggle" onclick="toggleTheme()" title="Toggle Theme"><i class="fas fa-moon"></i></button></li>
    </ul>
  </div>
</nav>

<div class="main-container" id="mainContainer">
  <div class="login-prompt" id="loginPrompt">
    <i class="fas fa-user-lock"></i>
    <h2>Please Log In to View Profile</h2>
    <p>To access your profile, you need to be signed in.</p>
    <a href="login.html" class="btn-login-prompt">Login</a>
    <p><small>Don't have an account? <a href="login.html" style="color: var(--primary-color);">Register here</a></small></p>
  </div>

  <div class="profile-card" id="profileContent">
    <div class="profile-header">
      <div class="profile-avatar-section">
        <div class="profile-avatar" id="profileAvatar">U</div>
        <div class="profile-info">
          <h1 id="profileUsername">User</h1>
          <p id="profileEmail">user@example.com</p>
        </div>
      </div>
      <button class="btn-edit" onclick="openEditModal()">Edit Profile</button>
    </div>

    <div class="profile-section">
      <h3><i class="fas fa-user"></i> Personal Information</h3>
      <div class="info-item">
        <span>Username:</span><span id="displayUsername">Loading...</span>
      </div>
      <div class="info-item">
        <span>Email:</span><span id="displayEmail">Loading...</span>
      </div>
    </div>
  </div>
</div>

<footer class="footer">
  <p>&copy; 2023 ApexChat. <a href="login.html">Login</a> | <a href="README.md">Docs</a></p>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
const API_BASE = 'http://localhost:8080/api';
let token = localStorage.getItem('token');
let currentUser = null;

// Theme toggle
function toggleTheme() {
  document.body.dataset.theme = document.body.dataset.theme==='dark'?'light':'dark';
}

// Logout
function logout() {
  localStorage.removeItem('token');
  window.location.href='login.html';
}

// Initialize page
async function init() {
  if(!token){
    document.getElementById('loginPrompt').style.display = 'flex';
    document.getElementById('profileContent').style.display = 'none';
    return;
  }
  try{
    const res = await fetch(`${API_BASE}/auth/verify`, { headers: { 'Authorization': 'Bearer ' + token } });
    if(res.ok){
      currentUser = await res.json();
      document.getElementById('userNameNav').textContent = currentUser.username;
      document.getElementById('userAvatarNav').textContent = currentUser.username.charAt(0);
      document.getElementById('profileUsername').textContent = currentUser.username;
      document.getElementById('profileEmail').textContent = currentUser.email;
      document.getElementById('displayUsername').textContent = currentUser.username;
      document.getElementById('displayEmail').textContent = currentUser.email;
      document.getElementById('loginPrompt').style.display='none';
      document.getElementById('profileContent').style.display='block';
    } else {
      logout();
    }
  } catch(err){
    console.error('Error verifying token:', err);
    logout();
  }
}

// Placeholder Edit Modal
function openEditModal() {
  alert('Edit Profile Modal would appear here.');
}

window.onload = init;
</script>
</body>
</html>
