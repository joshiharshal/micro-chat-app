<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>VartaChat - Dashboard</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
<style>
:root {
    --primary-color:#6366f1;
    --secondary-color:#8b5cf6;
    --bg-color:#f8fafc;
    --sidebar-bg:#ffffff;
    --chat-bg:#ffffff;
    --message-sent:#4f46e5;
    --message-received:#e2e8f0;
    --text-primary:#1e293b;
    --text-secondary:#64748b;
    --border-color:#e2e8f0;
    --shadow:0 4px 6px -1px rgba(0,0,0,0.1),0 2px 4px -1px rgba(0,0,0,0.06);
}
[data-theme="dark"] {
    --bg-color:#0f0f23;
    --sidebar-bg:#1a1a2e;
    --chat-bg:#1a1a2e;
    --message-received:#1e293b;
    --text-primary:#f8fafc;
    --text-secondary:#94a3b8;
    --border-color:#334155;
}
body {background:var(--bg-color); color:var(--text-primary); font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin:0; line-height:1.6;}
.navbar {background:var(--primary-color); padding:1rem 0; box-shadow:var(--shadow); position:sticky; top:0; z-index:1000;}
.navbar-brand {font-size:1.5rem; font-weight:bold; color:white !important;}
.nav-link {color: rgba(255,255,255,0.9) !important; margin:0 0.5rem; transition:color 0.2s;}
.nav-link:hover{color:white !important;}
.user-nav {display:flex; align-items:center; gap:1rem;}
.user-avatar-nav {width:35px; height:35px; border-radius:50%; background:rgba(255,255,255,0.2); display:flex; align-items:center; justify-content:center; color:white; font-weight:bold;}
.main-container {display:flex; min-height:calc(100vh - 80px); max-width:1400px; margin:2rem auto; gap:2rem; padding:0 1rem; flex-direction:column; align-items:center;}
.dashboard-card {background:var(--sidebar-bg); border:1px solid var(--border-color); border-radius:0.75rem; padding:2rem; box-shadow:var(--shadow); width:100%; max-width:800px; text-align:center;}
.quick-link {display:inline-block; margin:1rem; padding:1rem; background:var(--primary-color); color:white; text-decoration:none; border-radius:0.5rem; transition: transform 0.2s;}
.quick-link:hover{transform:scale(1.05); color:white;}
.footer {background:var(--sidebar-bg); border-top:1px solid var(--border-color); padding:2rem 0; text-align:center; color:var(--text-secondary); margin-top:2rem;}
.footer a {color:var(--primary-color); text-decoration:none;}
.theme-toggle {background:none; border:none; color:white; font-size:1.2rem; cursor:pointer;}
@media(max-width:768px){.main-container{margin:1rem;}}
</style>
</head>
<body data-theme="light">

<nav class="navbar navbar-expand-lg">
<div class="container">
<a class="navbar-brand" href="index.html"><i class="fas fa-comments"></i> VartaChat Dashboard</a>
<ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link active" href="index.html">Home</a></li>
<li class="nav-item"><a class="nav-link" href="chat.html">Chat</a></li>
<li class="nav-item"><a class="nav-link" href="group.html">Groups</a></li>
<li class="nav-item"><a class="nav-link" href="profile.html">Profile</a></li>
<li class="nav-item"><a class="nav-link" href="analytics.html">Analytics</a></li>
</ul>
<ul class="navbar-nav user-nav">
<li class="nav-item dropdown">
<a class="nav-link" href="#" role="button" data-bs-toggle="dropdown" id="userDropdown">
<div class="user-avatar-nav" id="userAvatar">G</div> <span id="userName">Guest</span>
</a>
<ul class="dropdown-menu">
<li><a class="dropdown-item" href="#settings">Settings</a></li>
<li><a class="dropdown-item" href="login.html" onclick="login()">login</a></li>
<li><a class="dropdown-item" href="#" onclick="logout()">Logout</a></li>
</ul>
</li>
<li class="nav-item"><button class="theme-toggle" onclick="toggleTheme()" title="Toggle Theme"><i class="fas fa-moon"></i></button></li>
</ul>
</div>
</div>
</nav>

<div class="main-container">
<div class="dashboard-card">
<h1>Welcome to VartaChat!</h1>
<p class="lead">Your microservices-powered chat platform. Choose a section to get started.</p>
<div>
<a href="chat.html" class="quick-link"><i class="fas fa-user"></i> Private Chats</a>
<a href="group.html" class="quick-link"><i class="fas fa-users"></i> Groups</a>
<a href="media.html" class="quick-link"><i class="fas fa-image"></i> Media Gallery</a>
<a href="history.html" class="quick-link"><i class="fas fa-history"></i> Message History</a>
<a href="profile.html" class="quick-link"><i class="fas fa-user-circle"></i> Profile</a>
</div>
<div class="mt-4">
<!-- <h4>Quick Stats</h4> -->
<div id="analyticsStats" class="row text-start"></div>
</div>
</div>
</div>

<footer class="footer">
<div class="container">
<p>&copy; 2023 VartaChat. Built with Microservices. <a href="login.html">Login</a> | <a href="README.md">Docs</a></p>
</div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
const API_BASE = 'http://localhost:8090/api';
let token = localStorage.getItem('token');
let currentUser = null;

// Optional: skip login for demo
if(!token) {
    currentUser = {username:'Guest'};
    document.getElementById('userName').textContent = currentUser.username;
    document.getElementById('userAvatar').textContent = currentUser.username.charAt(0);
    loadAnalyticsDemo();
} else {
    init();
}

async function init(){
    try{
        const response = await fetch(`${API_BASE}/auth/verify`, {
            headers: { 'Authorization':'Bearer ' + token }
        });
        if(response.ok){
            currentUser = await response.json();
            document.getElementById('userName').textContent = currentUser.username;
            document.getElementById('userAvatar').textContent = currentUser.username.charAt(0);
        } else {
            localStorage.removeItem('token');
            window.location.href='login.html';
        }
    } catch(err){
        console.error(err);
        window.location.href='login.html';
    }
    loadAnalytics();
}

async function loadAnalytics(){
    try{
        const response = await fetch(`${API_BASE}/analytics/user`, {
            headers:{'Authorization':'Bearer '+token}
        });
        if(response.ok){
            const stats = await response.json();
            renderStats(stats);
        } else {
            loadAnalyticsDemo();
        }
    } catch(err){ console.error(err); loadAnalyticsDemo(); }
}

// // Demo stats if API fails
// function loadAnalyticsDemo(){
//     const demoStats = { totalMessages: 120, groups: 5, media: 34, notifications: 2 };
//     renderStats(demoStats);
// }

// function renderStats(stats){
//     document.getElementById('analyticsStats').innerHTML = `
//         <div class="col-md-3"><i class="fas fa-comment fa-2x"></i><br>${stats.totalMessages} Messages</div>
//         <div class="col-md-3"><i class="fas fa-users fa-2x"></i><br>${stats.groups} Groups</div>
//         <div class="col-md-3"><i class="fas fa-image fa-2x"></i><br>${stats.media} Media</div>
//         <div class="col-md-3"><i class="fas fa-bell fa-2x"></i><br>${stats.notifications} Alerts</div>
//     `;
// }

function toggleTheme(){
    const body = document.body;
    body.dataset.theme = body.dataset.theme==='dark'?'light':'dark';
}
function logout(){
    localStorage.removeItem('token');
    window.location.href='login.html';
}
</script>
</body>
</html>
